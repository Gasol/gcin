Description: Pass CFLAGS and LDFLAGS to compiler and linker
 For Debian hardening flags.
 .
 Mentioned, but not yet push to upstream.
 Some hardening lintian warning still appears.
Author: Yao Wei (魏銘廷) <mwei@lxde.org>
Forwarded: http://hyperrate.com/thread.php?tid=27601
Last-Update: 2012-07-07
--- a/configure
+++ b/configure
@@ -36,7 +36,7 @@
   FREEBSD=1
 fi
 
-SO_FLAGS="-Wl,--as-needed -shared"
+SO_FLAGS="$LDFLAGS -Wl,--as-needed -shared"
 MAC_OS=0
 uname | grep Darwin > /dev/null 2> /dev/null
 if [ $? = 0 ]; then
@@ -303,7 +303,8 @@
 echo "libdir=\$(DESTDIR)$libdir" >> config.mak
 echo "gcinlibdir=\$(DESTDIR)$gcinlibdir" >> config.mak
 echo "includedir=\$(DESTDIR)$includedir" >> config.mak
-echo "LDFLAGS=-Wl,--as-needed $GTKLDFLAGS -lX11 -ldl -lm" >> config.mak
+echo "LDFLAGS_ENV=$LDFLAGS" >> config.mak
+echo "LDFLAGS=$LDFLAGS -Wl,--as-needed $GTKLDFLAGS -lX11 -ldl -lm" >> config.mak
 echo "GCIN_VERSION=$GCIN_VERSION" >> config.mak
 echo "GCIN_TABLE_DIR=\$(datadir_r)/gcin/table" >> config.mak
 echo "GCIN_OGG_DIR=\$(datadir_r)/gcin/ogg" >> config.mak
--- a/qt4-im/Makefile
+++ b/qt4-im/Makefile
@@ -8,7 +8,7 @@
 -DQT_IMMODULE -DPIC
 OBJS= moc_gcin-qt.o gcin-qt.o im-gcin-qt.o gcin-imcontext-qt.o
 .SUFFIXES:	.c .cpp .a .so .E .h
-LDFLAGS=-L../im-client -lgcin-im-client `pkg-config QtCore QtGui --libs`
+LDFLAGS=$(LDFLAGS_ENV) -L../im-client -lgcin-im-client `pkg-config QtCore QtGui --libs`
 all:    im-gcin.so
 
 .cpp.E:
--- a/suffixes-rule
+++ b/suffixes-rule
@@ -12,7 +12,8 @@
 	$(CCX) $(CFLAGS) -E -o $@ $<
 
 
-CFLAGS= -DUNIX=1 $(WALL) $(OPTFLAGS) $(GTKINC) -I./IMdkit/include -I./im-client -DDEBUG="0$(GCIN_DEBUG)" \
+CFLAGS+= \
+        -DUNIX=1 $(WALL) $(OPTFLAGS) $(GTKINC) -I./IMdkit/include -I./im-client -DDEBUG="0$(GCIN_DEBUG)" \
         -DGCIN_TABLE_DIR=\"$(GCIN_TABLE_DIR)\" \
         -DGCIN_OGG_DIR=\"$(GCIN_OGG_DIR)\" \
         -DDOC_DIR=\"$(DOC_DIR)\" \
